<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Comprehensive Cache-Busting Headers -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Last-Modified" content="0">
    <meta http-equiv="If-Modified-Since" content="0">
    <meta name="cache-control" content="no-cache">
    <meta name="expires" content="0">
    <meta name="pragma" content="no-cache">
    <title>StudyBuddy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        * { box-sizing: border-box; } /* More predictable box model */
        /* General Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f9ff; /* Tailwind sky-50 */
            overscroll-behavior-y: contain; 
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
        }
        .card {
            background-color: white;
            border-radius: 0.75rem; 
            padding: 1.5rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem; 
            font-weight: 600; 
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            border: 1px solid transparent;
            user-select: none; /* Prevent text selection on buttons */
        }
        .btn:active { /* Subtle feedback on tap */
            transform: scale(0.98);
        }
        .btn-primary { background-color: #0d9488; color: white; }
        .btn-primary:hover { background-color: #0f766e; box-shadow: 0 2px 10px -1px rgba(13, 148, 136, 0.5); }
        .btn-secondary { background-color: #475569; color: white; }
        .btn-secondary:hover { background-color: #334155; }
        .btn-outline { border-color: #0d9488; color: #0d9488; }
        .btn-outline:hover { background-color: #ccfbf1; color: #0f766e; }
        .btn-warning { background-color: #f59e0b; color: white; }
        .btn-warning:hover { background-color: #d97706; }
        .btn-danger { background-color: #dc2626; color: white; }
        .btn-danger:hover { background-color: #b91c1c; }

        /* --- New Google Login Button Style --- */
        .btn-google {
            background-color: #ffffff;
            color: #374151; /* gray-700 */
            border: 1px solid #d1d5db; /* gray-300 */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem; /* space between icon and text */
        }
        .btn-google:hover {
            background-color: #f9fafb; /* gray-50 */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        .google-icon {
            width: 1.25rem;
            height: 1.25rem;
        }

        /* Game Specific Styles */
        .game-card {
            min-height: 150px; display: flex; align-items: center; justify-content: center;
            text-align: center; cursor: pointer; border: 1px solid #99f6e4; 
            overflow-wrap: break-word; word-break: break-word;
        }
        .selected-match { border: 2px solid #0d9488; background-color: #f0fdfa; }
        .matched { opacity: 0.4; pointer-events: none; background-color: #a7f3d0; border-color: #34d399; }
        .incorrect-match-animation { animation: shake 0.4s; border: 2px solid #ef4444 !important; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-6px); } 75% { transform: translateX(6px); } }

        .mcq-option-btn, .part-selection-btn, .essentials-category-btn, .essentials-action-btn {
            display: block; width: 100%; text-align: left; margin-bottom: 0.5rem;
            background-color: #f8fafc; border: 1px solid #cbd5e1; color: #334155;
            white-space: normal; overflow: hidden; text-overflow: ellipsis; padding: 0.75rem 1rem;
        }
        .mcq-option-btn:hover, .part-selection-btn:hover, .essentials-category-btn:hover, .essentials-action-btn:hover {
            background-color: #f1f5f9; border-color: #94a3b8;
        }
        #mcqQuestion.speakable-question:hover { cursor: pointer; background-color: #e0f2f7; }
        .correct-answer { background-color: #d1fae5 !important; border-color: #6ee7b7 !important; color: #065f46 !important; }
        .incorrect-answer { background-color: #fee2e2 !important; border-color: #fca5a5 !important; color: #991b1b !important; }
        .stack-selection-btn { background-color: #eef2ff; color: #4338ca; border: 1px solid #c7d2fe; }
        .stack-selection-btn:hover { background-color: #e0e7ff; }

        /* UI Elements */
        #musicToggleBtn { position: fixed; top: 1rem; right: 1rem; z-index: 1000; background-color: rgba(255,255,255,0.7); backdrop-filter: blur(4px); border: 1px solid #99f6e4; color: #0d9488; }
        /* Hide music button when Live Notes modal is open to prevent overlap */
        #liveNotesModal:not(.hidden) {
            z-index: 2000;
        }
        #liveNotesModal:not(.hidden) ~ * #musicToggleBtn {
            z-index: 999; /* Lower than modal to prevent overlap */
        }
        .capybara-life-icon { width: 2rem; height: 2rem; color: #8d5524; transition: opacity 0.3s ease, transform 0.3s ease; vertical-align: middle; }
        .capybara-life-icon.mistake { opacity: 0.3; transform: scale(0.75) rotate(-8deg) translateX(2px); color: #a1a1aa; }
        #gameInfoBar {
            display: flex;
            justify-content: space-between;
            align-items: center; /* Center items vertically */
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background-color: #f8fafc;
            border-radius: 0.375rem;
            flex-wrap: wrap; 
            gap: 0.5rem; 
        }
        #mistakeTracker { display: flex; gap: 0.5rem; flex-shrink: 0; }
        #scoreDisplayContainer { display: flex; flex-direction: column; align-items: flex-end; flex-shrink: 0; margin-left: auto; /* Push to right if space allows */ }
        #currentScoreDisplay { font-size: 1.125rem; font-weight: 600; color: #0d9488; }
        #maxScoreDisplay { font-size: 0.875rem; color: #0f766e;}
        .truncate-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; max-width: 100%; }
        #roundCompleteMessage, #bonusRoundCountdownMessage { text-align: center; font-size: 1.5rem; font-weight: 600; color: #0d9488; padding: 2rem; border: 2px dashed #99f6e4; border-radius: 0.5rem; margin-top: 1rem; }

        #talkToMePhraseToRead { min-height: 80px; padding-bottom: 2.5rem; position: relative; }
        #talkToMeRecognizedText, #talkToMeReferenceDisplay { min-height: 40px; }
        #speakPhraseBtn { position: absolute; bottom: 0.5rem; left: 50%; transform: translateX(-50%); padding: 0.3rem; background-color: rgba(255,255,255,0.5); }
        #speakPhraseBtn svg { width: 1.25rem; height: 1.25rem; color: #0d9488; }
        #listenBtn.listening { background-color: #ef4444; color: white; }
        #listenBtn.listening:hover { background-color: #dc2626; }

        .header-logo-image { max-width: 120px; height: auto; margin: 0 auto; }
        #hearItOutLoudToggleBtn.active { background-color: #0d9488; color: white; }

        .selected-find-word { background-color: #cffafe !important; border-color: #67e8f9 !important; outline: 2px solid #06b6d4; }

        #fillInTheBlanksSentence.speakable-question:hover { cursor: pointer; background-color: #e0f2f7; }
        .blank-input { border-bottom: 2px solid #0d9488; padding: 0.25rem 0.5rem; margin: 0 0.25rem; background-color: transparent; text-align: center; min-width: 80px; }
        #fillInTheBlanksSentence .blank-placeholder { display: inline-block; width: 100px; border-bottom: 1px solid #334155; text-align: center; font-style: italic; color: #64748b; }

        #targetLanguageSelectorContainer { margin-bottom: 1rem; }
        #targetLanguageSelector, #languageSelectorInGame { 
            padding: 0.5rem; font-size: 0.875rem; border: 1px solid #cbd5e1;
            border-radius: 0.375rem; width: auto; 
        }
        #targetLanguageSelector:focus, #languageSelectorInGame:focus {
            outline: 2px solid transparent; outline-offset: 2px;
            border-color: #0d9488; box-shadow: 0 0 0 2px #0d9488;
        }
        #languageSelectionInGameContainer {
            display: flex; align-items: center; 
            flex-grow: 1; /* Allow it to take available space */
            flex-shrink: 1; /* Allow it to shrink */
            min-width: 130px; /* Give it a minimum width to prevent excessive squishing */
            margin-right: 0.5rem; /* Space before next item if wrapped */
        }
        #languageSelectionInGameContainer label {
            margin-right: 0.5rem; font-size: 0.875rem; color: #334155; white-space: nowrap;
        }
        #hearItOutLoudToggleBtn {
            flex-shrink: 0; /* Don't let this button shrink too much */
        }
        /* Drag and Drop Area */
        #dropZone {
            border: 3px dashed #99f6e4; /* Tailwind teal-200 */
            border-radius: 0.5rem; /* Tailwind rounded-lg */
            padding: 2rem;
            text-align: center;
            color: #0f766e; /* Tailwind teal-700 */
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
            margin-top: 1rem;
        }
        #dropZone.dragover-active {
            background-color: #ccfbf1; /* Tailwind teal-100 */
            border-color: #0d9488; /* Tailwind teal-600 */
        }

        /* New Login Form Styles */
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.5rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #0d9488;
            box-shadow: 0 0 0 2px rgba(13, 148, 136, 0.3);
        }
        .toggle-auth-link {
            color: #0d9488;
            cursor: pointer;
            text-decoration: underline;
        }

        /* Mobile Specific Adjustments */
        @media (max-width: 420px) { /* Slightly wider breakpoint for these general adjustments */
            .card {
                padding: 1rem; 
            }
            .game-card { 
                min-height: 100px; 
                padding: 0.5rem;  
                font-size: 0.875rem; 
            }
            #matchingGrid {
                gap: 0.5rem; 
            }
            .mcq-option-btn {
                padding: 0.6rem 0.8rem; 
                font-size: 0.875rem;
            }
            #mcqQuestion {
                min-height: 60px;
                font-size: 1rem;
            }

            #gameInfoBar {
                padding: 0.35rem;
                gap: 0.35rem;
            }
            #languageSelectionInGameContainer {
                min-width: 120px; 
                margin-left: 0.25rem;
            }
            #languageSelectionInGameContainer label,
            #languageSelectorInGame {
                font-size: 0.75rem; 
            }
            #languageSelectorInGame {
                padding: 0.35rem 0.25rem; /* More padding reduction */
                max-width: 120px; /* Prevent dropdown from becoming too wide */
            }
            #currentScoreDisplay {
                font-size: 1rem;
            }
            #maxScoreDisplay {
                font-size: 0.75rem;
            }
             #mistakeTracker {
                gap: 0.25rem; 
            }
            .capybara-life-icon {
                width: 1.5rem; height: 1.5rem;
            }
            #hearItOutLoudToggleBtn {
                padding: 0.25rem 0.5rem;
                font-size: 0.7rem;
            }
            #hearItOutLoudToggleBtn svg {
                width: 0.8rem; height: 0.8rem;
            }
            #gameHeader h2 { 
                font-size: 1.25rem; 
            }
            #gameHeader button { 
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
            }
            .btn { 
                padding: 0.6rem 1rem;
                font-size: 0.875rem;
            }
            #mainSelectionSection .btn, #uploadSection .btn, #essentialsCategorySelectionSection .btn, #essentialsCategoryOptionsSection .btn, #gameSelectionSection .btn {
                padding: 0.75rem; 
                font-size: 0.9rem;
            }
            #dropZone {
                padding: 1rem;
                font-size: 0.9rem;
            }
        }
        @media (max-width: 360px) { /* For very small screens */
            #languageSelectionInGameContainer {
                flex-basis: 100%; /* Make speech selector take full width if it wraps */
                margin-left: 0;
                margin-right: 0;
            }
            #languageSelectorInGame {
                width: 100%; /* Make dropdown full width within its container */
                max-width: none;
            }
            #hearItOutLoudToggleBtn {
                font-size: 0.65rem;
                padding: 0.2rem 0.4rem;
            }
             #gameInfoBar {
                justify-content: center; /* Center items if they all wrap */
            }
             #scoreDisplayContainer {
                margin-left: 0; /* Reset margin if centered */
                align-items: center;
            }
        }

        /* Live Notes Modal Styles */
        #liveNotesModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #liveNotesContainer {
            width: 98%;
            max-width: none;
            height: 98%;
            max-height: 98vh;
        }

        #liveNotesTextarea {
            background-color: #fffff0; /* Ivory */
            background-image: linear-gradient(#99f6e4 1px, transparent 1px);
            background-size: 100% 1.5rem; /* Approx 1.5rem line height */
            line-height: 1.5rem;
            border: 1px solid #0d9488;
            border-radius: 0.5rem;
            padding: 1rem;
            width: 100%;
            height: calc(100% - 120px); /* Leave space for header and controls */
            font-size: 1.2rem;
            resize: none;
        }

        #liveNotesTextarea:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.4);
        }
        
        .countdown-indicator {
            position: absolute;
            top: -8px;
            right: 8px;
            background: #0d9488;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .save-pending {
            color: #f59e0b !important;
        }
        
        .save-complete {
            color: #10b981 !important;
        }
        
        /* Prevent zoom on iOS */
        @media screen and (-webkit-min-device-pixel-ratio: 0) {
            select, textarea, input[type="text"], input[type="email"] {
                font-size: 16px;
            }
        }
        
        
        /* Cloud icon status styles */
        #cloudIcon.saved {
            color: #3b82f6; /* blue-500 */
        }
        
        #cloudIcon.pending {
            color: #f59e0b; /* amber-500 */
        }
        
        #uploadArrow {
            transition: opacity 0.3s ease;
        }
        
        #uploadArrow.show {
            opacity: 1;
        }
        
        #uploadArrow.hide {
            opacity: 0;
        }
        
        /* Helper class used by JS to hide/show elements */
        .hidden {
            display: none !important;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="min-h-screen flex flex-col items-center p-2 sm:p-4 md:p-6">

    <button id="musicToggleBtn" class="btn p-2 text-sm">
        <svg id="musicIconOn" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707A1 1 0 0112 5v14a1 1 0 01-1.707.707L5.586 15z" /></svg>
        <svg id="musicIconOff" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707A1 1 0 0112 5v14a1 1 0 01-1.707.707L5.586 15zM17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"/></svg>
        <span id="musicStatusText">Music: ON</span>
    </button>

    <div class="w-full max-w-3xl mx-auto"> 
        <header class="text-center mb-6 sm:mb-10">
            <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh7G7JZO-izPezsiQzlGVi10doRtWHuCKsp3u9txVRurU_ziVdRHtF5XswySzXYQMbLpJXCr3QvXSrSQdJIuzO9QeNIkjUKqHIayQZQUFQFP2bpmVr_5auHdT-lbCL8KaVkrjrbw5UJqJApeGTADnBy-r5G-CBhHOGsvuAy8cN7FyJxH8VrJHM2Bu4TqZo/s512/studybuddy.jpg" alt="StudyBuddy Logo" class="header-logo-image"
                 onerror="this.onerror=null; this.src='https://placehold.co/120x80/CCCCCC/000000?text=Logo';">
            <p class="text-2xl sm:text-3xl font-bold text-teal-700 mt-2">StudyBuddy</p>
            <p class="text-lg sm:text-xl text-teal-600 mt-1">Your fun way to master vocabulary!</p>
        </header>

        <!-- Cache Status Indicator -->
        <div id="cacheStatusBar" class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4 text-center text-sm">
            <div class="flex items-center justify-center gap-4 flex-wrap">
                <span class="text-yellow-800">
                    <strong>App Version:</strong> <span id="appVersionDisplay">Loading...</span>
                </span>
                <button id="forceCacheRefresh" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-xs font-medium transition-colors">
                    üîÑ Force Refresh
                </button>
                <span class="text-yellow-700 text-xs">
                    Seeing old content? Press Ctrl+Shift+R (PC) or Cmd+Shift+R (Mac)
                </span>
            </div>
        </div>

        <!-- Login Section -->
        <section id="loginSection" class="card mb-8">
            <h2 id="authTitle" class="text-2xl font-semibold text-teal-700 mb-4 text-center">Login to Your Account</h2>

            <form id="authForm" class="space-y-4">
                <div>
                    <label for="emailInput" class="block text-sm font-medium text-gray-700">Email Address</label>
                    <input type="email" id="emailInput" class="form-input mt-1" required>
                </div>
                <div>
                    <label for="passwordInput" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="passwordInput" class="form-input mt-1" required>
                </div>
                <button type="submit" id="authSubmitBtn" class="btn btn-primary w-full p-3 text-lg">Login</button>
            </form>
            <p id="authError" class="text-red-500 text-sm text-center mt-2 h-5"></p>

            <div class="relative my-6">
                <div class="absolute inset-0 flex items-center" aria-hidden="true"><div class="w-full border-t border-gray-300"></div></div>
                <div class="relative flex justify-center"><span class="bg-white px-2 text-sm text-gray-500">or</span></div>
            </div>

            <button id="googleLoginBtn" class="btn btn-google w-full p-4 text-lg">
                <svg class="google-icon" viewBox="0 0 48 48" aria-hidden="true"><path fill="#4285F4" d="M45.12 24.5c0-1.56-.14-3.06-.4-4.5H24v8.51h11.84c-.51 2.75-2.06 5.08-4.39 6.64v5.52h7.11c4.16-3.83 6.56-9.47 6.56-16.17z"></path><path fill="#34A853" d="M24 46c6.48 0 11.93-2.13 15.89-5.82l-7.11-5.52c-2.17 1.45-4.92 2.3-8.78 2.3-6.76 0-12.47-4.55-14.51-10.61H2.3v5.7C6.32 40.57 14.56 46 24 46z"></path><path fill="#FBBC05" d="M9.49 27.9c-.4-1.18-.62-2.45-.62-3.79s.22-2.61.62-3.79V14.6H2.3C.83 17.53 0 20.65 0 24.11s.83 6.58 2.3 9.51l7.19-5.72z"></path><path fill="#EA4335" d="M24 8.71c3.55 0 6.63 1.23 9.13 3.63l6.3-6.3C35.91 2.25 30.47 0 24 0 14.56 0 6.32 5.43 2.3 14.6l7.19 5.71C11.53 14.26 17.24 8.71 24 8.71z"></path></svg>
                <span>Continue with Google</span>
            </button>

            <p id="authToggleText" class="text-center text-sm mt-4">
                Don't have an account? <span id="toggleToSignUp" class="toggle-auth-link">Sign Up</span>
            </p>
        </section>

        <!-- Main App Content (hidden by default) -->
        <div id="appContent" class="hidden w-full">
            <div class="flex justify-between items-center mb-4">
                <button id="addNotesBtn" class="btn btn-secondary text-sm py-2 px-3">Add / Manage Notes</button>
                <div class="flex gap-2">
                    <button id="liveNotesBtn" class="btn btn-primary text-sm py-2 px-3">üìù Live Notes</button>
                    <button id="logoutBtn" class="btn btn-danger text-sm py-2 px-3">Logout</button>
                </div>
            </div>
            <section id="mainSelectionSection" class="card non-interactive-card mb-6 sm:mb-8">
                <h2 class="text-xl sm:text-2xl font-semibold text-teal-700 mb-4">Get Started</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                    <button id="showUploadSectionBtn" class="btn btn-primary p-4 sm:p-6 text-base sm:text-lg">Upload My Own List</button>
                    <button id="showEssentialsSectionBtn" class="btn btn-primary p-4 sm:p-6 text-base sm:text-lg">Study Essentials</button>
                </div>
            </section>

            <section id="uploadSection" class="card non-interactive-card mb-6 sm:mb-8 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl sm:text-2xl font-semibold text-teal-700">1. Upload Vocabulary</h2>
                    <button id="backToMainSelectionFromUploadBtn" class="btn btn-secondary text-xs sm:text-sm py-1 px-2">Back</button>
                </div>
                <div class="mb-4 p-3 sm:p-4 bg-teal-50 border border-teal-200 rounded-lg text-teal-800 text-sm sm:text-base">
                    <h3 class="font-semibold">CSV File Format:</h3>
                    <ul class="list-disc list-inside ml-2 sm:ml-4 text-xs sm:text-sm">
                        <li>Must be a CSV (Comma Separated Values) file.</li>
                        <li>The first row is assumed to be headers and will be ignored.</li>
                        <li>Column 1: Word/phrase in the language you are learning.</li>
                        <li>Column 2: Translation of the word/phrase (your language).</li>
                        <li>Example (Learning Tagalog, Translation English): <code>"kumusta","hello"</code></li>
                         <li>Fields containing commas or quotes must be enclosed in double quotes (e.g., <code>"word, with comma","translation"</code>).</li>
                        <li>A double quote within a quoted field should be represented as two double quotes (e.g., <code>"word with ""quote""","translation"</code>).</li>
                    </ul>
                </div>
                <div id="targetLanguageSelectorContainer" class="my-3 sm:my-4">
                    <label for="targetLanguageSelector" class="block mb-1 sm:mb-2 text-sm font-medium text-gray-900">Select Target Language (for Column 1 words):</label>
                    <select id="targetLanguageSelector" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 block w-full p-2 sm:p-2.5">
                        <option value="en-US" selected>English (US)</option>
                        <option value="en-GB">English (UK)</option>
                        <option value="es-ES">Espa√±ol (Espa√±a)</option>
                        <option value="es-MX">Espa√±ol (M√©xico)</option>
                        <option value="fr-FR">Fran√ßais (France)</option>
                        <option value="de-DE">Deutsch (German)</option>
                        <option value="it-IT">Italiano (Italian)</option>
                        <option value="pt-PT">Portugu√™s (Portugal)</option>
                        <option value="ja-JP">Êó•Êú¨Ë™û (Japanese)</option>
                        <option value="ko-KR">ÌïúÍµ≠Ïñ¥ (Korean)</option>
                        <option value="zh-CN">‰∏≠Êñá (ÁÆÄ‰Ωì Chinese)</option>
                        <option value="nl-NL">Nederlands (Dutch)</option>
                        <option value="ru-RU">–†—É—Å—Å–∫–∏–π (Russian)</option>
                        <option value="ar-SA">ÿßŸÑÿπÿ±ÿ®Ÿäÿ© (Arabic)</option>
                        <option value="hi-IN">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
                        <option value="tl-PH">Tagalog (Filipino)</option>
                    </select>
                </div>
                 <label for="csvFile" class="block mb-2 text-sm font-medium text-gray-900">Select CSV File or Drag & Drop Below:</label>
                <input type="file" id="csvFile" accept=".csv" class="block w-full text-sm text-gray-900 border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none focus:border-teal-500 p-2 sm:p-2.5 mb-2">
                <div id="dropZone">
                    <p>Drag & Drop CSV File Here</p>
                    <p class="text-xs mt-1">(or click the input field above)</p>
                </div>
                <button id="uploadBtn" class="btn btn-primary mt-3 sm:mt-4 w-full sm:w-auto">Load Vocabulary from Selected File</button>
                <p id="uploadStatus" class="text-sm text-slate-500 mt-2 h-5"></p>
            </section>

            <section id="essentialsCategorySelectionSection" class="card non-interactive-card mb-6 sm:mb-8 hidden">
                 <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl sm:text-2xl font-semibold text-teal-700">Study Essentials: Select a Category</h2>
                    <button id="backToMainSelectionFromEssentialsBtn" class="btn btn-secondary text-xs sm:text-sm py-1 px-2">Back</button>
                </div>
                <div id="essentialsCategoryButtonsContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3"></div>
            </section>

            <section id="essentialsCategoryOptionsSection" class="card non-interactive-card mb-6 sm:mb-8 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="essentialsOptionsTitle" class="text-xl sm:text-2xl font-semibold text-teal-700">Category: [Name]</h2>
                    <button id="backToEssentialsCategoriesBtn" class="btn btn-secondary text-xs sm:text-sm py-1 px-2">Change Category</button>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                    <button id="reviewEssentialsCategoryBtn" class="btn btn-outline essentials-action-btn p-4 sm:p-6 text-base sm:text-lg">Review This Category</button>
                    <button id="playGamesWithEssentialsBtn" class="btn btn-outline essentials-action-btn p-4 sm:p-6 text-base sm:text-lg">Play Games with This Category</button>
                </div>
            </section>

            <section id="gameSelectionSection" class="card non-interactive-card mb-6 sm:mb-8 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl sm:text-2xl font-semibold text-teal-700">2. Select a Game</h2>
                    <button id="backToSourceSelectionBtn" class="btn btn-secondary text-xs sm:text-sm py-1 px-2">Back</button>
                </div>
                <div id="gameButtonsContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                    <button id="matchingBtn" class="btn btn-outline p-4 sm:p-6 text-base sm:text-lg">Matching Game</button>
                    <button id="multipleChoiceBtn" class="btn btn-outline p-4 sm:p-6 text-base sm:text-lg">Multiple Choice</button>
                    <button id="typeTranslationBtn" class="btn btn-outline p-4 sm:p-6 text-base sm:text-lg">Type Translation</button>
                    <button id="talkToMeBtn" class="btn btn-outline p-4 sm:p-6 text-base sm:text-lg">Talk to Me (Speak)</button>
                    <button id="fillInTheBlanksBtn" class="btn btn-outline p-4 sm:p-6 text-base sm:text-lg hidden">Fill in the Blanks</button>
                    <button id="findTheWordsBtn" class="btn btn-outline p-4 sm:p-6 text-base sm:text-lg">Find the Words</button>
                </div>
            </section>

            <section id="gameArea" class="card non-interactive-card hidden">
                <div id="gameHeader" class="flex justify-between items-center mb-2">
                     <h2 id="gameTitle" class="text-xl sm:text-2xl md:text-3xl font-semibold text-teal-700">Game</h2>
                     <button id="backToGameSelectionBtn" class="btn btn-secondary text-xs sm:text-sm py-1.5 px-2 sm:py-2 sm:px-3">Back to Games</button>
                </div>
                <div id="gameInfoBar">
                    <div class="flex items-center space-x-1 sm:space-x-2 flex-grow basis-1/3"> <div id="mistakeTracker" class="flex space-x-1"></div>
                         <div id="languageSelectionInGameContainer" class="hidden">
                             <label for="languageSelectorInGame" class="text-xs sm:text-sm text-slate-700">Speech:</label>
                             <select id="languageSelectorInGame" class="bg-gray-50 border border-gray-300 text-gray-900 text-xs sm:text-sm rounded-md sm:rounded-lg focus:ring-teal-500 focus:border-teal-500 block p-1.5 sm:p-2.5">
                                 <option value="en-US">English (US)</option>
                                 <option value="en-GB">English (UK)</option>
                                 <option value="es-ES">Espa√±ol (Espa√±a)</option>
                                 <option value="es-MX">Espa√±ol (M√©xico)</option>
                                 <option value="fr-FR">Fran√ßais (France)</option>
                                 <option value="de-DE">Deutsch (German)</option>
                                 <option value="it-IT">Italiano (Italian)</option>
                                 <option value="pt-PT">Portugu√™s (Portugal)</option>
                                 <option value="ja-JP">Êó•Êú¨Ë™û (Japanese)</option>
                                 <option value="ko-KR">ÌïúÍµ≠Ïñ¥ (Korean)</option>
                                 <option value="zh-CN">‰∏≠Êñá (ÁÆÄ‰Ωì Chinese)</option>
                                 <option value="nl-NL">Nederlands (Dutch)</option>
                                 <option value="ru-RU">–†—É—Å—Å–∫–∏–π (Russian)</option>
                                 <option value="ar-SA">ÿßŸÑÿπÿ±ÿ®Ÿäÿ© (Arabic)</option>
                                 <option value="hi-IN">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
                                 <option value="tl-PH">Tagalog (Filipino)</option>
                             </select>
                         </div>
                    </div>
                    <div class="flex items-center justify-center flex-grow basis-1/3"> <button id="hearItOutLoudToggleBtn" class="btn btn-outline text-xs sm:text-sm py-1 px-1.5 sm:py-1 sm:px-2 hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 inline-block mr-0.5 sm:mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707A1 1 0 0112 5v14a1 1 0 01-1.707.707L5.586 15z"></path></svg>
                        <span id="hearItOutLoudBtnText">Hear: OFF</span>
                    </button>
                    </div>
                    <div id="scoreDisplayContainer" class="text-right flex-grow basis-1/3"> <div id="currentScoreDisplay" class="text-lg sm:text-xl font-semibold text-teal-600">Score: 0</div>
                         <div id="maxScoreDisplay" class="text-xs sm:text-sm text-teal-500">Max Score: 0</div>
                    </div>
                </div>
                <p id="ttsGeneralStatus" class="text-center text-xs text-red-500 mt-1 h-4"></p>
                <hr class="my-3 sm:my-4 border-teal-200">

                <div id="partSelectionContainer" class="hidden mb-4 sm:mb-6">
                    <h3 class="text-lg sm:text-xl font-semibold text-teal-700 mb-2 sm:mb-3">Choose a Part to Study:</h3>
                    <div id="partButtonsContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3"></div>
                </div>

                <div id="matchingGame" class="hidden">
                    <p id="matchingInstructions" class="text-slate-600 mb-3 sm:mb-4 text-sm sm:text-base">Match Target Language to Your Language.</p>
                    <div id="matchingGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 sm:gap-3 md:gap-4"></div>
                    <p id="matchingFeedback" class="text-center font-medium mt-3 sm:mt-4 h-5 sm:h-6 text-sm sm:text-base"></p>
                    <div class="text-center mt-3 sm:mt-4">
                         <button id="resetCurrentPartBtn" class="btn btn-primary">Restart This Part</button>
                    </div>
                </div>

                 <div id="findTheWordsGame" class="hidden">
                    <p id="findTheWordsInstructions" class="text-slate-600 mb-2 text-sm sm:text-base">Listen carefully and select the words you hear (in the Target Language).</p>
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-3 sm:mb-4 gap-2">
                        <button id="replayFindTheWordsAudioBtn" class="btn btn-secondary text-xs sm:text-sm py-1.5 px-2 sm:py-2 sm:px-3 w-full sm:w-auto">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707A1 1 0 0112 5v14a1 1 0 01-1.707.707L5.586 15z"></path></svg>
                            Replay Audio
                        </button>
                        <span id="findTheWordsRoundCounter" class="text-xs sm:text-sm text-slate-500">Round: 1/5</span>
                    </div>
                    <div id="findTheWordsGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 sm:gap-3 mb-3 sm:mb-4"></div>
                    <button id="sendFindTheWordsBtn" class="btn btn-primary w-full sm:w-auto" disabled>Send Answer</button>
                    <p id="findTheWordsFeedback" class="text-center font-medium mt-3 sm:mt-4 h-5 sm:h-6 text-sm sm:text-base"></p>
                    <div class="text-center mt-4 sm:mt-6">
                        <button id="nextFindTheWordsRoundBtn" class="btn btn-primary hidden">Next Round</button>
                    </div>
                </div>

                <div id="multipleChoiceGame" class="hidden">
                    <p id="mcqInstructions" class="text-slate-600 mb-3 sm:mb-4 text-sm sm:text-base">Choose the correct Translation for the Target Language word.</p>
                    <div id="mcqQuestion" class="card non-interactive-card bg-sky-50 p-3 sm:p-4 mb-3 sm:mb-4 text-lg sm:text-xl font-medium text-sky-700 text-center min-h-[70px] sm:min-h-[80px] flex items-center justify-center"></div>
                    <div id="mcqOptions" class="space-y-2 sm:space-y-3"></div>
                    <p id="mcqFeedback" class="text-center font-medium mt-3 sm:mt-4 h-5 sm:h-6 text-sm sm:text-base"></p>
                    <div class="text-center mt-4 sm:mt-6">
                        <button id="nextMcqBtn" class="btn btn-primary hidden">Next Question</button>
                    </div>
                </div>

                <div id="typeTranslationGame" class="hidden">
                    <p id="typeTranslationInstructions" class="text-slate-600 mb-3 sm:mb-4 text-sm sm:text-base">Type the Target Language translation for the word/phrase shown in Your Language.</p>
                    <div id="typeTranslationPhrase" class="card non-interactive-card bg-sky-50 p-3 sm:p-4 mb-3 sm:mb-4 text-lg sm:text-xl font-medium text-sky-700 text-center min-h-[70px] sm:min-h-[80px] flex items-center justify-center"></div>
                    <input type="text" id="typeTranslationInput" class="w-full p-2.5 sm:p-3 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 mb-2 text-sm sm:text-base" placeholder="Type Target Language translation here...">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-3 sm:mb-4 gap-2">
                        <button id="hintTypeTranslationBtn" class="btn btn-warning text-xs sm:text-sm py-1.5 px-2 sm:py-2 sm:px-3 w-full sm:w-auto">Hint</button>
                        <p id="typeTranslationHintDisplay" class="text-xs sm:text-sm text-amber-700 h-5 flex-grow text-right pr-0 sm:pr-2"></p>
                    </div>
                    <button id="checkTypeTranslationBtn" class="btn btn-primary w-full sm:w-auto">Check Answer</button>
                    <p id="typeTranslationFeedback" class="text-center font-medium mt-3 sm:mt-4 h-5 sm:h-6 text-sm sm:text-base"></p>
                    <div class="text-center mt-4 sm:mt-6">
                        <button id="nextTypeTranslationBtn" class="btn btn-primary hidden">Next Phrase</button>
                    </div>
                     <p id="typeTranslationCounter" class="text-center text-xs sm:text-sm text-slate-500 mt-3 sm:mt-4"></p>
                </div>

                <div id="fillInTheBlanksGame" class="hidden">
                    <p id="fillInTheBlanksInstructions" class="text-slate-600 mb-3 sm:mb-4 text-sm sm:text-base">Fill in the blank with the correct English word (Essentials Mode Only).</p>
                    <div id="fillInTheBlanksSentence" class="card non-interactive-card bg-sky-50 p-4 sm:p-6 mb-3 sm:mb-4 text-lg sm:text-xl font-medium text-sky-700 text-center min-h-[80px] sm:min-h-[100px] flex items-center justify-center leading-relaxed"></div>
                    <input type="text" id="fillInTheBlanksInput" class="w-full p-2.5 sm:p-3 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 mb-3 sm:mb-4 text-sm sm:text-base" placeholder="Type the missing word...">
                    <button id="checkFillInTheBlanksBtn" class="btn btn-primary w-full sm:w-auto">Check Answer</button>
                    <p id="fillInTheBlanksFeedback" class="text-center font-medium mt-3 sm:mt-4 h-5 sm:h-6 text-sm sm:text-base"></p>
                    <div class="text-center mt-4 sm:mt-6">
                        <button id="nextFillInTheBlanksBtn" class="btn btn-primary hidden">Next Question</button>
                    </div>
                    <p id="fillInTheBlanksCounter" class="text-center text-xs sm:text-sm text-slate-500 mt-3 sm:mt-4"></p>
                </div>

                <div id="talkToMeGame" class="hidden">
                    <p id="talkToMeInstructions" class="text-slate-600 mb-2 text-sm sm:text-base">Read the Target Language phrase aloud.</p>
                    <div id="talkToMePhraseToRead" class="card non-interactive-card bg-sky-100 border-sky-300 p-4 sm:p-6 mb-3 sm:mb-4 text-xl sm:text-2xl font-semibold text-sky-800 text-center relative">
                        <span id="talkToMePhraseText"></span>
                        <button id="speakPhraseBtn" class="btn btn-outline p-1 absolute bottom-1 sm:bottom-2 left-1/2 transform -translate-x-1/2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                        </button>
                    </div>
                    <div class="flex flex-col sm:flex-row items-center justify-center space-y-2 sm:space-y-0 sm:space-x-3 mb-3 sm:mb-4">
                        <button id="listenBtn" class="btn btn-primary w-full sm:w-auto">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 inline-block mr-1 sm:mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H7a1 1 0 100 2h6a1 1 0 100-2h-2v-2.07z" clip-rule="evenodd" /></svg>
                            <span id="listenBtnText">Start Listening</span>
                        </button>
                        <button id="nextTalkToMeBtn" class="btn btn-secondary w-full sm:w-auto hidden">Next Phrase</button>
                    </div>
                    <div class="my-2 sm:my-3 p-2 sm:p-3 bg-slate-50 rounded-lg border border-slate-200">
                        <p class="text-xs sm:text-sm text-slate-500 mb-1">What I heard:</p>
                        <p id="talkToMeRecognizedText" class="text-slate-700 font-medium italic text-sm sm:text-base">...</p>
                    </div>
                    <p id="talkToMeFeedback" class="text-center font-medium mt-2 sm:mt-3 h-5 sm:h-6 text-sm sm:text-base"></p>
                    <div id="talkToMeReferenceContainer" class="mt-2 sm:mt-3 p-2 sm:p-3 bg-emerald-50 rounded-lg border border-emerald-200 hidden">
                         <p id="talkToMeReferenceLabel" class="text-xs sm:text-sm text-emerald-600 mb-1">Your Language Translation:</p>
                         <p id="talkToMeReferenceDisplay" class="text-emerald-700 font-medium text-sm sm:text-base"></p>
                    </div>
                    <p id="talkToMeCounter" class="text-center text-xs sm:text-sm text-slate-500 mt-3 sm:mt-4"></p>
                    <p id="speechApiStatus" class="text-center text-xs text-red-500 mt-1 sm:mt-2 h-4"></p>
                </div>

                <div id="roundCompleteMessage" class="hidden"></div>
                <div id="bonusRoundCountdownMessage" class="hidden"></div>
                <p id="gameOverMessage" class="text-center text-xl sm:text-2xl font-bold text-red-600 my-4 sm:my-6 hidden"></p>
                <p id="noVocabularyMessage" class="text-center text-red-500 hidden">Please upload a vocabulary list first.</p>
            </section>

            <!-- Live Notes Modal -->
            <div id="liveNotesModal" class="hidden">
                <div id="liveNotesContainer" class="card">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-teal-700">üìù Live Notes</h2>
                        <div class="flex gap-2 items-center">
                            <div id="saveStatusContainer" class="flex items-center gap-1">
                                <svg id="cloudIcon" class="w-5 h-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M5.5 16c-2.485 0-4.5-2.015-4.5-4.5s2.015-4.5 4.5-4.5c.485 0 .954.078 1.39.22C7.813 5.072 9.706 3.5 12 3.5c2.761 0 5 2.239 5 5 0 .126-.005.25-.014.374A3.5 3.5 0 0116.5 16.5h-11z"/>
                                </svg>
                                <svg id="uploadArrow" class="w-3 h-3 text-orange-500 hidden" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                </svg>
                                <span id="saveStatus" class="text-sm text-gray-600">All saved</span>
                            </div>
                            <button id="manualSaveBtn" class="btn btn-primary text-sm py-1 px-3 flex items-center gap-1">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6a1 1 0 10-2 0v5.586l-1.293-1.293z"/>
                                </svg>
                                Save Now
                            </button>
                            <button id="closeLiveNotesBtn" class="btn btn-secondary text-sm py-1 px-3">‚úï Close</button>
                        </div>
                    </div>
                    
                    <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <p class="text-sm text-blue-800">
                            ‚úçÔ∏è Write naturally in your notepad! Use a dash (-) to separate words from their translations.
                            <br>Example: "hello - hola" or "good morning - buenos d√≠as"
                            <br>Each line with word/phrase + dash + translation gets automatically saved.
                        </p>
                    </div>
                    
                    <div class="mb-3">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-lg font-semibold text-gray-700">üìù Your Notepad</h3>
                            <div class="text-sm text-gray-500">
                                <span id="lineCount">Lines: 0</span> | <span id="parsedCount">Parsed: 0</span>
                            </div>
                        </div>
                        
                        <!-- Control Buttons positioned above textarea -->
                        <div class="flex justify-center gap-2 mb-3">
                            <button id="previousLineBtn" class="btn btn-secondary text-sm py-1 px-2">‚Üë Previous Line</button>
                            <button id="newLineBtn" class="btn btn-primary text-sm py-1 px-2">+ New Line</button>
                            <button id="clearAllBtn" class="btn btn-warning text-sm py-1 px-2">Clear All</button>
                        </div>
                        
                        <textarea 
                            id="liveNotesTextarea" 
                            placeholder="Start writing your notes here...

word - translation
phrase - definition
bonjour - hello
buenos d√≠as - good morning

Use a dash (-) to separate words from their translations."
                            autocorrect="off"
                            autocapitalize="off" 
                            spellcheck="false"
                        ></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
